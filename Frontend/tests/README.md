# End-to-end Tests Using Playwright

## Usage

Run all tests:

```sh
npm run e2e
```

Configure using variables in `.env` (see `.env.example`).

### Run Individual Tests

When not called via `npm`, tests need to be compiled, e.g.:

```sh
tsc --watch -p tests/tsconfig.json
```

Then you can use IDE integration like for VSCode or run tests manually:

```sh
# Run all tests of login.spec.ts in Chromium, visibly showing the browser
npx playwright test playwright/out/scenarios/login.spec.js --project chromium --headed
# Run test matching the given pattern in Chromium and enabled Playwright inspector
npx playwright test --project chromium --debug -g 'should remove an element from the collection'
```

## Writing Tests

### Page Objects

We perform page interaction in [page object classes](https://playwright.dev/docs/test-pom). These
classes have the knowledge of how to interact with a certain page, while test scenarios describe
tests on a higher level. We initialize page objects with each test providing `Page`.

```ts
// search.page.ts
export class SearchPage {
    constructor(private readonly page: Page) {}

    // ...
}
```

```ts
// search.spec.ts

// Initialize page object
let searchPage: SearchPage;
test.beforeEach(async ({ page }) => {
    searchPage = new SearchPage(page);
});

// Use in test
test('should go to search page', async () => {
    await searchPage.goto({ expectMaterials: true });
});
```

All page interactions should be performed through page objects.

### Test Steps

Test steps are used to organize groups of actions. We implement tests steps in page objects and mark
them with the `@testStep` decorator:

```ts
import { testStep } from '../util/test-step';

export class SearchPage {
    @testStep()
    async expectToHaveElement(pattern: string | RegExp) {
        await expect(this.getElement(pattern)).toBeVisible();
    }
}
```

Test steps serve the following purposes:

-   reusable steps to be called by test scenarios in `.spec` files
-   group steps to make the test report generated by Playwright easier to read
-   do additional testing for JavaScript and API errors

All page interactions should be wrapped by at least—and ideally exactly—one test step.
