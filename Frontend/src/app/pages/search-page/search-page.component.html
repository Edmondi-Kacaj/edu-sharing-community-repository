<!-- <mat-progress-bar mode="indeterminate"></mat-progress-bar> -->

<ng-container *ngIf="tabBarIsVisible; else noTabsPage">
  <nav mat-tab-nav-bar [tabPanel]="tabPanel">
    <a
      mat-tab-link
      *ngFor="let repository of availableRepositories.getValue()"
      (click)="activeRepository.setUserValue(repository.id)"
      [active]="repository.id === activeRepository.getValue()"
    >
      <div class="repository-icon">
        <img [src]="repository | repositoryIcon" alt="" />
      </div>
      {{ repository.title }}
    </a>
  </nav>
  <ng-container *ngTemplateOutlet="toolbar"></ng-container>
  <mat-tab-nav-panel #tabPanel>
    <ng-container *ngTemplateOutlet="tabBody"></ng-container>
  </mat-tab-nav-panel>
</ng-container>

<ng-template #noTabsPage>
  <ng-container *ngTemplateOutlet="toolbar"></ng-container>
  <ng-container *ngTemplateOutlet="tabBody"></ng-container>
</ng-template>

<ng-template #toolbar>
  <es-search-page-toolbar
    [(filterBarIsVisible)]="filterBarIsVisible.value"
  ></es-search-page-toolbar>
</ng-template>

<ng-template #tabBody>
  <mat-drawer-container #filterBar>
    <mat-drawer [opened]="filterBarIsVisible.getValue()" mode="side">
      <es-search-page-filter-bar></es-search-page-filter-bar>
    </mat-drawer>
    <main>
      <es-node-entries-wrapper
        *ngIf="!collectionsDataSource.isEmpty()"
        [dataSource]="collectionsDataSource"
        [scope]="Scope.Search"
        [columns]="columns"
        [disableInfiniteScroll]="true"
        [displayType]="NodeEntriesDisplayType.SmallGrid"
        [gridConfig]="{ maxRows: shouldLimitCollectionRows ? 1 : -1 }"
      >
        <ng-template #title>
          <div class="collections-heading-container">
            <h2>{{ 'SEARCH.COLLECTIONS' | translate }}</h2>
            <button
              *ngIf="
                collectionsDataSource.itemsCap?.isActivelyCapping || !shouldLimitCollectionRows
              "
              mat-button
              color="primary"
              class="toggle"
              (click)="shouldLimitCollectionRows = !shouldLimitCollectionRows"
            >
              {{ (shouldLimitCollectionRows ? 'SHOW_MORE' : 'HIDE_MORE') | translate }}
            </button>
          </div>
        </ng-template>
      </es-node-entries-wrapper>
      <h2>{{ 'SEARCH.MATERIALS' | translate }}</h2>
      <es-node-entries-wrapper
        #nodeEntriesResults
        [dataSource]="resultsDataSource"
        [scope]="Scope.Search"
        [columns]="columns"
      >
        <ng-template #empty>
          <div class="no-search-results-message">
            <i esIcon="search"></i>
            {{ 'SEARCH.QUERY_NO_RESULT' | translate }}
          </div>
        </ng-template>
      </es-node-entries-wrapper>
    </main>
  </mat-drawer-container>
</ng-template>
